(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[592],{43389:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=43389,e.exports=t},391:function(){},63191:function(){},79726:function(e,t,n){"use strict";n.d(t,{Zq:function(){return s},cl:function(){return i},i9:function(){return a}});var r=n(70442);n(26449);var o=n(23797);function i(e){let{children:t,title:n="Dashboard",description:o,className:i,headerActions:s}=e;return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 ".concat(i||""),children:(0,r.jsxs)("div",{className:"container mx-auto p-4 space-y-6",children:[(0,r.jsxs)("header",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:justify-between md:space-y-0",children:[(0,r.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:n}),o&&(0,r.jsx)("p",{className:"text-muted-foreground",children:o})]}),s&&(0,r.jsx)("div",{className:"flex items-center space-x-2",children:s})]}),(0,r.jsx)("main",{id:"main-content",className:"grid gap-6",tabIndex:-1,children:t})]})})}function s(e){let{children:t}=e;return(0,r.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:t})}function a(e){let{title:t,value:n,description:i,trend:s,icon:a,loading:c=!1}=e;return(0,r.jsxs)(o.Zb,{children:[(0,r.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(o.ll,{className:"text-sm font-medium",children:t}),a&&(0,r.jsx)("div",{className:"h-4 w-4",children:a})]}),(0,r.jsx)(o.aY,{children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mb-2"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded animate-pulse w-3/4"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:n}),i&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:i}),s&&(0,r.jsxs)("p",{className:"text-xs ".concat({up:"text-green-600 dark:text-green-400",down:"text-red-600 dark:text-red-400",neutral:"text-gray-600 dark:text-gray-400"}[s.direction]," mt-1"),children:["up"===s.direction&&"↗","down"===s.direction&&"↘","neutral"===s.direction&&"→",s.value]})]})})]})}},19328:function(e,t,n){"use strict";n.d(t,{ry:function(){return m},Yg:function(){return d},z7:function(){return h}});var r=n(70442);n(26449);var o=n(69110),i=n(23797);function s(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{responsive:e,maintainAspectRatio:t,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:6,displayColors:!1,callbacks:{label:function(e){let t=e.dataset.label||"",n=e.parsed.y||e.parsed;return"".concat(t,": ").concat("number"==typeof n?n.toLocaleString():n)}}}},scales:{x:{grid:{display:!1}},y:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}}}function a(e){let{title:t,description:n,children:o,loading:s=!1,error:a,className:c=""}=e;return(0,r.jsxs)(i.Zb,{className:"".concat(c),children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{className:"text-lg font-semibold",children:t}),n&&(0,r.jsx)(i.SZ,{children:n})]}),(0,r.jsx)(i.aY,{children:s?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100"})}):a?(0,r.jsx)("div",{className:"flex items-center justify-center h-64 text-red-500",children:(0,r.jsxs)("p",{children:["Error loading chart: ",a]})}):(0,r.jsx)("div",{className:"h-64",children:o})})]})}o.kL.register(o.uw,o.f$,o.od,o.jn,o.ZL,o.Dx,o.u,o.De,o.qi);let c={primary:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)"],borders:["rgba(59, 130, 246, 1)","rgba(16, 185, 129, 1)","rgba(245, 158, 11, 1)","rgba(239, 68, 68, 1)","rgba(139, 92, 246, 1)","rgba(236, 72, 153, 1)"],success:"rgba(16, 185, 129, 0.8)",warning:"rgba(245, 158, 11, 0.8)",error:"rgba(239, 68, 68, 0.8)",info:"rgba(59, 130, 246, 0.8)"},l={pending:c.info,running:c.warning,active:c.primary[0],idle:"rgba(156, 163, 175, 0.8)",completed:c.success,failed:c.error,cancelled:"rgba(107, 114, 128, 0.8)"};var u=n(63896);function d(e){let{title:t="Task Status Distribution",description:n="Current distribution of task states",data:o,options:i,loading:c=!1,error:d,className:h=""}=e,m={labels:Object.keys(o).map(e=>e.charAt(0).toUpperCase()+e.slice(1)),datasets:[{data:Object.values(o),backgroundColor:Object.keys(o).map(e=>l[e]),borderColor:Object.keys(o).map(e=>l[e].replace("0.8","1")),borderWidth:2,hoverBackgroundColor:Object.keys(o).map(e=>l[e].replace("0.8","0.9"))}]},f={...s(!0,!1),...i,plugins:{...s().plugins,legend:{position:"bottom",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{callbacks:{label:function(e){let t=e.label||"",n=e.parsed,r=e.dataset.data.reduce((e,t)=>e+t,0),o=r>0?(n/r*100).toFixed(1):"0";return"".concat(t,": ").concat(n," (").concat(o,"%)")}}}}};return(0,r.jsx)(a,{title:t,description:n,loading:c,error:d,className:h,children:(0,r.jsx)(u.$I,{data:m,options:f})})}function h(e){let{title:t="Task Completion Trends",description:n="Task completion rates over time",data:o,timeRange:i="24h",options:l,loading:d=!1,error:h,className:m=""}=e,f={labels:o.timestamps,datasets:[{label:"Completed",data:o.completed,borderColor:c.success,backgroundColor:c.success.replace("0.8","0.1"),fill:!0,tension:.4,pointRadius:3,pointHoverRadius:5},{label:"Failed",data:o.failed,borderColor:c.error,backgroundColor:c.error.replace("0.8","0.1"),fill:!0,tension:.4,pointRadius:3,pointHoverRadius:5},{label:"Cancelled",data:o.cancelled,borderColor:c.borders[5],backgroundColor:c.primary[5].replace("0.8","0.1"),fill:!0,tension:.4,pointRadius:3,pointHoverRadius:5}]},g={...s(!0,!1),...l,scales:{x:{title:{display:!0,text:"Time"},grid:{display:!1}},y:{title:{display:!0,text:"Number of Tasks"},beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}}},interaction:{intersect:!1,mode:"index"}};return(0,r.jsx)(a,{title:t,description:"".concat(n," (").concat(i,")"),loading:d,error:h,className:m,children:(0,r.jsx)(u.x1,{data:f,options:g})})}function m(e){let{title:t="System Performance Metrics",description:n="Real-time system performance data",data:o,metric:i="all",options:l,loading:d=!1,error:h,className:m=""}=e,f={labels:o.labels,datasets:(()=>{let e=[];return("execution"===i||"all"===i)&&e.push({label:"Execution Time (ms)",data:o.executionTimes,backgroundColor:c.primary[0],borderColor:c.borders[0],borderWidth:1,yAxisID:"y"}),("memory"===i||"all"===i)&&e.push({label:"Memory Usage (MB)",data:o.memoryUsage,backgroundColor:c.primary[1],borderColor:c.borders[1],borderWidth:1,yAxisID:"all"===i?"y1":"y"}),("cpu"===i||"all"===i)&&e.push({label:"CPU Usage (%)",data:o.cpuUsage,backgroundColor:c.primary[2],borderColor:c.borders[2],borderWidth:1,yAxisID:"all"===i?"y2":"y"}),e})()},g={...s(!0,!1),...l,scales:"all"===i?{x:{title:{display:!0,text:"Time Interval"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Execution Time (ms)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Memory (MB)"},grid:{drawOnChartArea:!1}},y2:{type:"linear",display:!1,position:"right",max:100}}:{x:{title:{display:!0,text:"Time Interval"}},y:{title:{display:!0,text:"execution"===i?"Time (ms)":"memory"===i?"Memory (MB)":"CPU Usage (%)"},beginAtZero:!0,max:"cpu"===i?100:void 0}},plugins:{...s().plugins,tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"",n=e.parsed.y,r="";return t.includes("Time")?r=" ms":t.includes("Memory")?r=" MB":t.includes("CPU")&&(r="%"),"".concat(t,": ").concat(n.toLocaleString()).concat(r)}}}}};return(0,r.jsx)(a,{title:t,description:n,loading:d,error:h,className:m,children:(0,r.jsx)(u.$Q,{data:f,options:g})})}},77098:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var r=n(70442),o=n(26449),i=n(74497),s=n(59873),a=n(72237);let c=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=o.forwardRef((e,t)=>{let{className:n,variant:o,size:s,asChild:l=!1,...u}=e,d=l?i.g7:"button";return(0,r.jsx)(d,{className:(0,a.cn)(c({variant:o,size:s,className:n})),ref:t,...u})});l.displayName="Button"},23797:function(e,t,n){"use strict";n.d(t,{Ol:function(){return a},SZ:function(){return l},Zb:function(){return s},aY:function(){return u},ll:function(){return c}});var r=n(70442),o=n(26449),i=n(72237);let s=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...o})});s.displayName="Card";let a=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",n),...o})});a.displayName="CardHeader";let c=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",n),...o})});c.displayName="CardTitle";let l=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...o})});l.displayName="CardDescription";let u=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",n),...o})});u.displayName="CardContent",o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",n),...o})}).displayName="CardFooter"},30719:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(70442),o=n(26449),i=n(72237);let s=o.forwardRef((e,t)=>{let{className:n,type:o,...s}=e;return(0,r.jsx)("input",{type:o,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});s.displayName="Input"},30129:function(e,t,n){"use strict";n.d(t,{LiveRegion:function(){return a},XE:function(){return i},h7:function(){return s}});var r=n(70442),o=n(26449);function i(){let e=(0,o.useRef)(null);return(0,o.useEffect)(()=>()=>{e.current&&e.current.parentNode&&e.current.parentNode.removeChild(e.current)},[]),{announce:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;e.current&&(e.current.textContent=""),setTimeout(()=>{if(!e.current){let t=document.createElement("div");t.setAttribute("aria-live",n),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",document.body.appendChild(t),e.current=t}e.current.setAttribute("aria-live",n),e.current.textContent=t},r)},clear:()=>{e.current&&(e.current.textContent="")}}}let s={loading:e=>e?"Loading ".concat(e):"Loading",loaded:e=>e?"".concat(e," loaded successfully"):"Content loaded successfully",error:(e,t)=>{let n=e?"Error loading ".concat(e):"An error occurred";return t?"".concat(n,": ").concat(t):n},saved:e=>e?"".concat(e," saved successfully"):"Changes saved successfully",deleted:e=>e?"".concat(e," deleted successfully"):"Item deleted successfully",updated:e=>e?"".concat(e," updated successfully"):"Content updated successfully",progress:(e,t,n)=>{let r="Progress: ".concat(Math.round(e/t*100),"%");return n?"".concat(r," - ").concat(n):r}};function a(e){let{message:t,priority:n="polite",clearDelay:i=5e3}=e,s=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(t&&s.current&&(s.current.textContent=t,i>0)){let e=setTimeout(()=>{s.current&&(s.current.textContent="")},i);return()=>clearTimeout(e)}},[t,i]),(0,r.jsx)("div",{ref:s,"aria-live":n,"aria-atomic":"true",className:"sr-only",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"}})}},4934:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return d},a:function(){return h}});var r=n(70442),o=n(26449),i=n(94057),s=n(68338),a=n(49767);let c=(e,t)=>{switch(t.type){case"AUTH_START":return{...e,isLoading:!0,error:null};case"AUTH_SUCCESS":return{user:t.payload.user,token:t.payload.token,isAuthenticated:!0,isLoading:!1,error:null};case"AUTH_ERROR":return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:t.payload};case"AUTH_LOGOUT":return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null};case"AUTH_INIT":if(t.payload)return{user:t.payload.user,token:t.payload.token,isAuthenticated:!0,isLoading:!1,error:null};return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null};default:return e}},l=(0,o.createContext)(void 0),u={user:null,token:null,isAuthenticated:!1,isLoading:!0,error:null},d=e=>{let{children:t,apiBaseUrl:n=a.env.NEXT_PUBLIC_API_URL||"http://localhost:3001"}=e,[d,h]=(0,o.useReducer)(c,u),m=(0,o.useCallback)(()=>{let e=i.q.getToken(),t=i.q.getUser();e&&t&&!i.l.isTokenExpired(e)?h({type:"AUTH_INIT",payload:{user:t,token:e}}):(i.q.clearAll(),h({type:"AUTH_INIT",payload:null}))},[]),f=(0,o.useCallback)(async e=>{h({type:"AUTH_START"});try{let t=await fetch("".concat(n,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Login failed")}let r=await t.json();i.q.setToken(r.token),i.q.setUser(r.user),h({type:"AUTH_SUCCESS",payload:{user:r.user,token:r.token}})}catch(e){throw h({type:"AUTH_ERROR",payload:e instanceof Error?e.message:"Login failed"}),e}},[n]),g=(0,o.useCallback)(async()=>{try{let e=i.q.getToken();e&&await fetch("".concat(n,"/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).catch(()=>{})}finally{i.q.clearAll(),h({type:"AUTH_LOGOUT"})}},[n]),p=(0,o.useCallback)(async()=>{let e=i.q.getRefreshToken();if(!e){g();return}try{let t=await fetch("".concat(n,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)throw Error("Token refresh failed");let r=await t.json();i.q.setToken(r.token),i.q.setUser(r.user),h({type:"AUTH_SUCCESS",payload:{user:r.user,token:r.token}})}catch(e){g()}},[n,g]);(0,o.useEffect)(()=>{if(!d.token)return;let e=setInterval(()=>{i.l.isTokenExpired(d.token)&&p()},6e4);return()=>clearInterval(e)},[d.token,p]),(0,o.useEffect)(()=>{m()},[m]);let b=(0,s.qL)(d.user),v={...d,login:f,logout:g,refreshToken:p,permissions:b};return(0,r.jsx)(l.Provider,{value:v,children:t})},h=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},35148:function(e,t,n){"use strict";n.d(t,{aC:function(){return r.a}}),n(26449);var r=n(4934)},68338:function(e,t,n){"use strict";n.d(t,{qL:function(){return i}});class r{hasPermission(e){return!!this.user&&("admin"===this.user.role||this.user.permissions.includes(e))}hasAnyPermission(e){return!!this.user&&e.some(e=>this.hasPermission(e))}hasAllPermissions(e){return!!this.user&&e.every(e=>this.hasPermission(e))}hasRole(e){return!!this.user&&this.user.role===e}canAccessResource(e,t){let n="".concat(e,":").concat(t);return this.hasPermission(n)}constructor(e){this.user=e}}class o{static hasMinimumRole(e,t){return this.hierarchy[e]>=this.hierarchy[t]}static canElevateToRole(e,t){return"admin"===t?"admin"===e:"user"!==t||"admin"===e||"user"===e}}o.hierarchy={viewer:1,user:2,admin:3};let i=e=>{let t=new r(e);return{can:e=>t.hasPermission(e),canAny:e=>t.hasAnyPermission(e),canAll:e=>t.hasAllPermissions(e),isRole:e=>t.hasRole(e),isAdmin:()=>t.hasRole("admin"),isUser:()=>t.hasRole("user"),isViewer:()=>t.hasRole("viewer"),canManageTasks:()=>t.canAccessResource("tasks","create")||t.canAccessResource("tasks","update")||t.canAccessResource("tasks","delete"),canViewTasks:()=>t.canAccessResource("tasks","read"),canAccessDashboard:()=>t.canAccessResource("dashboard","read"),canManageUsers:()=>t.hasRole("admin"),showIfCan:(e,n)=>t.hasPermission(e)?n:null,showIfRole:(e,n)=>t.hasRole(e)?n:null,showIfMinRole:(t,n)=>e&&o.hasMinimumRole(e.role,t)?n:null}}},94057:function(e,t,n){"use strict";n.d(t,{l:function(){return a},q:function(){return c}});let r="auth_token",o="auth_user",i="refresh_token";class s{isLocalStorageAvailable(){try{let e="test";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}setItem(e,t){if(this.isLocalStorageAvailable())localStorage.setItem(e,t);else try{sessionStorage.setItem(e,t)}catch(e){console.warn("Storage not available")}}getItem(e){if(this.isLocalStorageAvailable())return localStorage.getItem(e);try{return sessionStorage.getItem(e)}catch(e){return null}}removeItem(e){if(this.isLocalStorageAvailable())localStorage.removeItem(e);else try{sessionStorage.removeItem(e)}catch(e){}}getToken(){return this.getItem(r)}setToken(e){this.setItem(r,e)}removeToken(){this.removeItem(r)}getRefreshToken(){return this.getItem(i)}setRefreshToken(e){this.setItem(i,e)}removeRefreshToken(){this.removeItem(i)}getUser(){let e=this.getItem(o);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}setUser(e){this.setItem(o,JSON.stringify(e))}removeUser(){this.removeItem(o)}clearAll(){this.removeToken(),this.removeRefreshToken(),this.removeUser()}}class a{static decodePayload(e){try{let t=e.split(".");if(3!==t.length)return null;let n=t[1],r=atob(n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(r)}catch(e){return null}}static isTokenExpired(e){let t=this.decodePayload(e);if(!t||!t.exp)return!0;let n=Math.floor(Date.now()/1e3);return t.exp<n}static getTokenExpiration(e){let t=this.decodePayload(e);return t&&t.exp?new Date(1e3*t.exp):null}static extractUserFromToken(e){let t=this.decodePayload(e);return t?{id:t.sub,email:t.email,role:t.role,permissions:t.permissions||[]}:null}}let c=new s},72237:function(e,t,n){"use strict";n.d(t,{cn:function(){return i}});var r=n(20829),o=n(65711);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}},79316:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var r=n(58807),o=n(26422),i=n(94057),s=n(60133),a=n(49767);class c{async connect(){if(this.connectionState.isConnected||this.connectionState.isConnecting){this.log("Already connected or connecting");return}this.connectionState.isConnecting=!0,this.connectionState.error=null;try{this.log("Connecting to WebSocket server:",this.config.url),this.socket=(0,r.io)(this.config.url,{timeout:this.config.timeout,transports:["websocket","polling"],autoConnect:!1}),this.setupEventListeners(),await new Promise((e,t)=>{let n=setTimeout(()=>{t(Error("Connection timeout"))},this.config.timeout);this.socket.once("connect",()=>{clearTimeout(n),e()}),this.socket.once("connect_error",e=>{clearTimeout(n),t(e)}),this.socket.connect()}),this.connectionState.isConnected=!0,this.connectionState.isConnecting=!1,this.connectionState.lastConnectedAt=new Date,this.connectionState.reconnectAttempts=0,this.log("Connected to WebSocket server");let e=i.q.getToken();e&&!i.l.isTokenExpired(e)&&await this.authenticate(e)}catch(e){throw this.connectionState.isConnecting=!1,this.connectionState.error=e instanceof Error?e.message:"Connection failed",this.log("Connection failed:",e),this.config.autoReconnect&&this.scheduleReconnect(),e}}disconnect(){this.log("Disconnecting from WebSocket server"),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.authRetryTimer&&(clearTimeout(this.authRetryTimer),this.authRetryTimer=null),this.socket&&(this.socket.disconnect(),this.socket=null),this.connectionState.isConnected=!1,this.connectionState.isConnecting=!1,this.connectionState.isAuthenticated=!1,this.connectionState.lastDisconnectedAt=new Date,this.connectionState.reconnectAttempts=0,this.roomSubscriptions.clear()}async authenticate(e){if(!this.socket||!this.connectionState.isConnected)throw Error("Not connected to WebSocket server");if(i.l.isTokenExpired(e))throw Error("Token is expired");return this.log("Authenticating with server"),new Promise((t,n)=>{let r=setTimeout(()=>{n(Error("Authentication timeout"))},this.config.timeout);this.socket.once("auth:success",e=>{clearTimeout(r),this.connectionState.isAuthenticated=!0,this.connectionState.error=null,this.log("Authentication successful:",e),t()}),this.socket.once("auth:error",e=>{clearTimeout(r),this.connectionState.isAuthenticated=!1,this.connectionState.error=e.message||"Authentication failed",this.log("Authentication failed:",e),n(Error(e.message||"Authentication failed"))}),this.socket.emit("authenticate",{token:e})})}isConnected(){return this.connectionState.isConnected}isAuthenticated(){return this.connectionState.isAuthenticated}getConnectionState(){return{...this.connectionState}}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t),this.log("Event listener registered for: ".concat(e))}off(e,t){let n=this.eventListeners.get(e);n&&(n.delete(t),0===n.size&&this.eventListeners.delete(e),this.log("Event listener removed for: ".concat(e)))}emit(e,t){let n=this.eventListeners.get(e);n&&n.forEach(n=>{try{n(t)}catch(t){this.log("Error in event listener for ".concat(e,":"),t)}})}async joinRoom(e){if(!this.socket||!this.connectionState.isAuthenticated)throw Error("Not connected or authenticated");return new Promise((t,n)=>{let r=setTimeout(()=>{n(Error("Failed to join room: ".concat(e)))},this.config.timeout);this.socket.once("room:joined",n=>{n.room===e&&(clearTimeout(r),this.roomSubscriptions.has(e)?this.roomSubscriptions.get(e).isSubscribed=!0:this.roomSubscriptions.set(e,{room:e,subscriptions:new Set,isSubscribed:!0}),this.log("Joined room: ".concat(e,", members: ").concat(n.members)),t())}),this.socket.once("room:error",t=>{clearTimeout(r),this.log("Failed to join room ".concat(e,":"),t),n(Error(t.message||"Failed to join room: ".concat(e)))}),this.socket.emit("join:room",{room:e})})}async leaveRoom(e){if(!this.socket)throw Error("Not connected");return new Promise((t,n)=>{let r=setTimeout(()=>{n(Error("Failed to leave room: ".concat(e)))},this.config.timeout);this.socket.once("room:left",n=>{if(n.room===e){clearTimeout(r);let n=this.roomSubscriptions.get(e);n&&(n.isSubscribed=!1),this.log("Left room: ".concat(e)),t()}}),this.socket.emit("leave:room",{room:e})})}subscribeToRoom(e,t,n){this.roomSubscriptions.has(e)||this.roomSubscriptions.set(e,{room:e,subscriptions:new Set,isSubscribed:!1}),this.roomSubscriptions.get(e).subscriptions.add(n),this.on(t,n),this.log("Subscribed to ".concat(t," in room: ").concat(e))}unsubscribeFromRoom(e,t,n){let r=this.roomSubscriptions.get(e);r&&(r.subscriptions.delete(n),this.off(t,n),this.log("Unsubscribed from ".concat(t," in room: ").concat(e)))}getRoomSubscriptions(){let e={};return this.roomSubscriptions.forEach((t,n)=>{e[n]={...t}}),e}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{this.log("Socket connected"),this.connectionState.isConnected=!0,this.connectionState.isConnecting=!1,this.connectionState.lastConnectedAt=new Date,this.connectionState.reconnectAttempts=0}),this.socket.on("disconnect",e=>{this.log("Socket disconnected:",e),this.connectionState.isConnected=!1,this.connectionState.isAuthenticated=!1,this.connectionState.lastDisconnectedAt=new Date,"io server disconnect"===e?this.connectionState.error="Server disconnected":this.config.autoReconnect&&this.scheduleReconnect()}),this.socket.on("connect_error",e=>{this.log("Connection error:",e),this.connectionState.error=e.message,this.config.autoReconnect&&this.scheduleReconnect()}),this.socket.onAny((e,t)=>{try{let n={event:e,timestamp:new Date().toISOString(),...t},r=s.k6.parse(n);this.emit(r.event,r)}catch(t){t instanceof o.jm?this.log("Invalid event format for ".concat(e,":"),t.errors):this.log("Error processing event ".concat(e,":"),t)}}))}scheduleReconnect(){if(this.connectionState.reconnectAttempts>=this.config.maxReconnectAttempts){this.log("Max reconnection attempts reached"),this.connectionState.error="Max reconnection attempts reached";return}let e=Math.min(this.config.reconnectInterval*Math.pow(2,this.connectionState.reconnectAttempts),3e4);this.connectionState.reconnectAttempts++,this.log("Scheduling reconnection attempt ".concat(this.connectionState.reconnectAttempts," in ").concat(e,"ms")),this.reconnectTimer=setTimeout(()=>{this.log("Reconnection attempt ".concat(this.connectionState.reconnectAttempts)),this.connect().catch(e=>{this.log("Reconnection failed:",e)})},e)}log(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.config.enableDebugLogs&&console.log("[WebSocket] ".concat(e),...n)}constructor(e={}){this.socket=null,this.eventListeners=new Map,this.roomSubscriptions=new Map,this.reconnectTimer=null,this.authRetryTimer=null,this.config={url:a.env.NEXT_PUBLIC_WEBSOCKET_URL||"ws://localhost:3001",autoReconnect:!0,reconnectInterval:1e3,maxReconnectAttempts:5,timeout:1e4,enableDebugLogs:!1,...e},this.connectionState={isConnected:!1,isConnecting:!1,isAuthenticated:!1,reconnectAttempts:0,lastConnectedAt:null,lastDisconnectedAt:null,error:null},this.log("WebSocket client initialized with config:",this.config)}}let l=new c},91852:function(e,t,n){"use strict";n.d(t,{WebSocketProvider:function(){return c}});var r=n(70442),o=n(26449),i=n(79316),s=n(8802);let a=(0,o.createContext)(void 0);function c(e){let{children:t,client:n=i.k,autoConnect:c=!0,room:l}=e,u=(0,s.h5)(l,n),d=(0,o.useRef)(!1);(0,o.useEffect)(()=>{!c||d.current||u.isConnected||u.isConnecting||(d.current=!0,u.connect().catch(e=>{console.error("Auto-connect failed:",e)}))},[c,u]);let h={client:n,isConnected:u.isConnected,isAuthenticated:u.isAuthenticated,isConnecting:u.isConnecting,error:u.error,connect:u.connect,disconnect:u.disconnect,authenticate:u.authenticate,isAuthenticating:u.isAuthenticating,authError:u.authError};return(0,r.jsx)(a.Provider,{value:h,children:t})}},8802:function(e,t,n){"use strict";n.d(t,{AV:function(){return a},h5:function(){return c},uE:function(){return s}});var r=n(26449),o=n(79316),i=n(94057);function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.k,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=(0,r.useRef)(t);s.current=t,(0,r.useEffect)(()=>{let t=e=>{s.current(e)};return n.on(e,t),()=>{n.off(e,t)}},[n,e,...i])}function a(){var e,t,n,i;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.k,[c,l]=(0,r.useState)(null),[u,d]=(0,r.useState)(null);return s("system:status",(0,r.useCallback)(e=>{l(e.data),d(new Date)},[]),a),{systemStatus:c,lastUpdate:u,activeTasks:null!==(e=null==c?void 0:c.activeTasks)&&void 0!==e?e:0,queueLength:null!==(t=null==c?void 0:c.queueLength)&&void 0!==t?t:0,workerStatus:null!==(n=null==c?void 0:c.workerStatus)&&void 0!==n?n:"unavailable",uptime:null!==(i=null==c?void 0:c.uptime)&&void 0!==i?i:0}}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.k,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.k,[t,n]=(0,r.useState)(e.getConnectionState()),i=(0,r.useCallback)(async()=>{try{await e.connect()}catch(e){console.error("Failed to connect to WebSocket:",e)}},[e]),s=(0,r.useCallback)(()=>{e.disconnect()},[e]);return(0,r.useEffect)(()=>{let t=()=>{n(e.getConnectionState())};return e.on("auth:success",t),e.on("auth:error",t),e.on("user:connected",t),e.on("user:disconnected",t),t(),e.isConnected()||i(),()=>{e.off("auth:success",t),e.off("auth:error",t),e.off("user:connected",t),e.off("user:disconnected",t)}},[e,i]),{connectionState:t,connect:i,disconnect:s,isConnected:t.isConnected,isAuthenticated:t.isAuthenticated,isConnecting:t.isConnecting,error:t.error}}(t),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.k,[t,n]=(0,r.useState)(!1),[s,a]=(0,r.useState)(null),c=(0,r.useCallback)(async()=>{let t=i.q.getToken();if(!t)return a("No authentication token available"),!1;n(!0),a(null);try{return await e.authenticate(t),!0}catch(e){return a(e instanceof Error?e.message:"Authentication failed"),!1}finally{n(!1)}},[e]);return(0,r.useEffect)(()=>{let t=()=>{c()};return e.on("auth:required",t),()=>{e.off("auth:required",t)}},[e,c]),(0,r.useEffect)(()=>{!e.isConnected()||e.isAuthenticated()||t||c()},[e,c,t]),{authenticate:c,isAuthenticating:t,authError:s}}(t),c=e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.k,[n,i]=(0,r.useState)(!1),[s,a]=(0,r.useState)(!1),[c,l]=(0,r.useState)(null),u=(0,r.useCallback)(async()=>{if(!n&&!s){a(!0),l(null);try{await t.joinRoom(e),i(!0)}catch(e){l(e instanceof Error?e.message:"Failed to join room")}finally{a(!1)}}},[t,e,n,s]),d=(0,r.useCallback)(async()=>{if(n)try{await t.leaveRoom(e),i(!1)}catch(e){l(e instanceof Error?e.message:"Failed to leave room")}},[t,e,n]),h=(0,r.useCallback)((n,r)=>{t.subscribeToRoom(e,n,r)},[t,e]),m=(0,r.useCallback)((n,r)=>{t.unsubscribeFromRoom(e,n,r)},[t,e]);return(0,r.useEffect)(()=>{!t.isAuthenticated()||n||s||u()},[t,u,n,s]),(0,r.useEffect)(()=>()=>{n&&d()},[d,n]),{isSubscribed:n,isJoining:s,error:c,joinRoom:u,leaveRoom:d,subscribeToEvent:h,unsubscribeFromEvent:m}}(e,t):null,l=a(t);return{...n,...s,room:c?{...c,room:e}:null,systemStatus:l.systemStatus,systemLastUpdate:l.lastUpdate}}},60133:function(e,t,n){"use strict";n.d(t,{k6:function(){return v}});var r=n(63103),o=n(35527);let i=r.Ry({event:r.Z_(),timestamp:r.Z_().datetime(),id:r.Z_().uuid().optional()}),s=i.extend({event:r.i0("task:update"),data:o.TaskStatusSchema}),a=i.extend({event:r.i0("task:created"),data:r.Ry({taskId:r.Z_(),sessionName:r.Z_(),userId:r.Z_(),createdAt:r.Z_().datetime()})}),c=i.extend({event:r.i0("task:completed"),data:r.Ry({taskId:r.Z_(),result:r.Z_().optional(),duration:r.Rx(),exitCode:r.Rx()})}),l=i.extend({event:r.i0("task:error"),data:r.Ry({taskId:r.Z_(),error:r.Z_(),stackTrace:r.Z_().optional()})}),u=i.extend({event:r.i0("system:status"),data:r.Ry({activeTasks:r.Rx(),queueLength:r.Rx(),workerStatus:r.Km(["healthy","degraded","unavailable"]),uptime:r.Rx()})}),d=i.extend({event:r.i0("user:connected"),data:r.Ry({userId:r.Z_(),sessionId:r.Z_(),connectedAt:r.Z_().datetime()})}),h=i.extend({event:r.i0("user:disconnected"),data:r.Ry({userId:r.Z_(),sessionId:r.Z_(),disconnectedAt:r.Z_().datetime(),reason:r.Z_().optional()})}),m=i.extend({event:r.i0("auth:required"),data:r.Ry({message:r.Z_(),retryAfter:r.Rx().optional()})}),f=i.extend({event:r.i0("auth:success"),data:r.Ry({userId:r.Z_(),sessionId:r.Z_(),permissions:r.IX(r.Z_())})}),g=i.extend({event:r.i0("auth:error"),data:r.Ry({message:r.Z_(),code:r.Z_()})}),p=i.extend({event:r.i0("room:joined"),data:r.Ry({room:r.Z_(),members:r.Rx()})}),b=i.extend({event:r.i0("room:left"),data:r.Ry({room:r.Z_(),reason:r.Z_().optional()})}),v=r.VK("event",[s,a,c,l,u,d,h,m,f,g,p,b])},34702:function(e,t,n){"use strict";var r=n(40918);n.o(r,"TaskState")&&n.d(t,{TaskState:function(){return r.TaskState}})},35527:function(e,t,n){"use strict";var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};Object.defineProperty(t,"__esModule",{value:!0}),t.workerConfig=void 0,function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)}(n(56254),t);var o=n(77364);Object.defineProperty(t,"workerConfig",{enumerable:!0,get:function(){return o.default}})},77364:function(e,t,n){"use strict";var r=n(49767);Object.defineProperty(t,"__esModule",{value:!0});let o=n(12142),i=n(56254);t.default=(0,o.registerAs)("worker",()=>{let e={maxConcurrentTasks:parseInt(r.env.WORKER_MAX_CONCURRENT_TASKS||"5"),processTimeoutMs:parseInt(r.env.WORKER_PROCESS_TIMEOUT_MS||"600000"),gracefulShutdownMs:parseInt(r.env.WORKER_GRACEFUL_SHUTDOWN_MS||"5000"),pidCheckIntervalMs:parseInt(r.env.WORKER_PID_CHECK_INTERVAL_MS||"1000"),fileWatchTimeoutMs:parseInt(r.env.WORKER_FILE_WATCH_TIMEOUT_MS||"30000"),inactivityTimeoutMs:parseInt(r.env.WORKER_INACTIVITY_TIMEOUT_MS||"120000"),pythonExecutable:r.env.PYTHON_EXECUTABLE||"python3",wrapperScriptPath:r.env.PYTHON_WRAPPER_SCRIPT_PATH||"./scripts/claude_wrapper.py",wrapperWorkingDir:r.env.PYTHON_WRAPPER_WORKING_DIR,queueName:r.env.BULLMQ_QUEUE_NAME||"claude-code-tasks",redisHost:r.env.REDIS_HOST||"localhost",redisPort:parseInt(r.env.REDIS_PORT||"6379"),redisPassword:r.env.REDIS_PASSWORD,logLevel:r.env.LOG_LEVEL||"info",enableDetailedLogs:"true"===r.env.ENABLE_DETAILED_LOGS,sessionLogsDir:r.env.SESSION_LOGS_DIR,awaitWriteFinish:"false"!==r.env.AWAIT_WRITE_FINISH,awaitWriteFinishMs:parseInt(r.env.AWAIT_WRITE_FINISH_MS||"100")};return i.WorkerConfigSchema.parse(e)})},56254:function(e,t,n){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.validateTaskStatus=t.validateWorkerConfig=t.validateClaudeCodeOptions=t.validateTaskExecutionRequest=t.validateProcessConfig=t.TaskStatusSchema=t.WorkerConfigSchema=t.TaskExecutionRequestSchema=t.ClaudeCodeOptionsSchema=t.ProcessConfigSchema=t.TaskState=void 0;let i=n(42396);(o=r||(t.TaskState=r={})).PENDING="pending",o.RUNNING="running",o.ACTIVE="active",o.IDLE="idle",o.COMPLETED="completed",o.FAILED="failed",o.CANCELLED="cancelled",t.ProcessConfigSchema=i.z.object({jobId:i.z.string().min(1,"Job ID is required"),sessionName:i.z.string().min(1,"Session name is required"),workingDirectory:i.z.string().min(1,"Working directory is required"),pythonExecutable:i.z.string().optional().default("python3"),wrapperScriptPath:i.z.string().min(1,"Wrapper script path is required"),unbuffered:i.z.boolean().default(!0)}),t.ClaudeCodeOptionsSchema=i.z.object({model:i.z.string().optional(),maxTokens:i.z.number().positive().optional(),temperature:i.z.number().min(0).max(2).optional(),timeout:i.z.number().positive().optional().default(3e5),permission_mode:i.z.enum(["bypassPermissions","default","plan","acceptEdits"]).optional()}),t.TaskExecutionRequestSchema=i.z.object({id:i.z.string().min(1,"Task ID is required"),prompt:i.z.string().min(1,"Prompt is required"),sessionName:i.z.string().min(1,"Session name is required"),workingDirectory:i.z.string().min(1,"Working directory is required"),options:t.ClaudeCodeOptionsSchema,timeoutMs:i.z.number().positive().optional().default(3e5)}),t.WorkerConfigSchema=i.z.object({maxConcurrentTasks:i.z.number().positive().default(5),processTimeoutMs:i.z.number().positive().default(6e5),gracefulShutdownMs:i.z.number().positive().default(5e3),pidCheckIntervalMs:i.z.number().positive().default(1e3),fileWatchTimeoutMs:i.z.number().positive().default(3e4),inactivityTimeoutMs:i.z.number().positive().default(12e4),pythonExecutable:i.z.string().default("python3"),wrapperScriptPath:i.z.string().min(1,"Wrapper script path is required"),wrapperWorkingDir:i.z.string().optional(),queueName:i.z.string().default("claude-code-tasks"),redisHost:i.z.string().default("localhost"),redisPort:i.z.number().positive().default(6379),redisPassword:i.z.string().optional(),logLevel:i.z.enum(["fatal","error","warn","info","debug","trace"]).default("info"),enableDetailedLogs:i.z.boolean().default(!1),sessionLogsDir:i.z.string().optional(),awaitWriteFinish:i.z.boolean().default(!0),awaitWriteFinishMs:i.z.number().positive().default(100)}),t.TaskStatusSchema=i.z.object({taskId:i.z.string(),state:i.z.nativeEnum(r),pid:i.z.number().optional(),progress:i.z.string().optional(),lastActivity:i.z.date(),error:i.z.string().optional(),exitCode:i.z.number().optional()}),t.validateProcessConfig=e=>t.ProcessConfigSchema.parse(e),t.validateTaskExecutionRequest=e=>t.TaskExecutionRequestSchema.parse(e),t.validateClaudeCodeOptions=e=>t.ClaudeCodeOptionsSchema.parse(e),t.validateWorkerConfig=e=>t.WorkerConfigSchema.parse(e),t.validateTaskStatus=e=>t.TaskStatusSchema.parse(e)},40918:function(e,t,n){"use strict";var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)}(n(38678),t)},38678:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskState=void 0;var r=n(35527);Object.defineProperty(t,"TaskState",{enumerable:!0,get:function(){return r.TaskState}})}}]);