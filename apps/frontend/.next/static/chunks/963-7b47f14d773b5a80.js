(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[963],{43389:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=43389,e.exports=t},391:function(){},63191:function(){},15130:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return m}});var o=n(70442),i=n(26449),s=n(94057);class r{hasPermission(e){return!!this.user&&("admin"===this.user.role||this.user.permissions.includes(e))}hasAnyPermission(e){return!!this.user&&e.some(e=>this.hasPermission(e))}hasAllPermissions(e){return!!this.user&&e.every(e=>this.hasPermission(e))}hasRole(e){return!!this.user&&this.user.role===e}canAccessResource(e,t){let n="".concat(e,":").concat(t);return this.hasPermission(n)}constructor(e){this.user=e}}class a{static hasMinimumRole(e,t){return this.hierarchy[e]>=this.hierarchy[t]}static canElevateToRole(e,t){return"admin"===t?"admin"===e:"user"!==t||"admin"===e||"user"===e}}a.hierarchy={viewer:1,user:2,admin:3};let c=e=>{let t=new r(e);return{can:e=>t.hasPermission(e),canAny:e=>t.hasAnyPermission(e),canAll:e=>t.hasAllPermissions(e),isRole:e=>t.hasRole(e),isAdmin:()=>t.hasRole("admin"),isUser:()=>t.hasRole("user"),isViewer:()=>t.hasRole("viewer"),canManageTasks:()=>t.canAccessResource("tasks","create")||t.canAccessResource("tasks","update")||t.canAccessResource("tasks","delete"),canViewTasks:()=>t.canAccessResource("tasks","read"),canAccessDashboard:()=>t.canAccessResource("dashboard","read"),canManageUsers:()=>t.hasRole("admin"),showIfCan:(e,n)=>t.hasPermission(e)?n:null,showIfRole:(e,n)=>t.hasRole(e)?n:null,showIfMinRole:(t,n)=>e&&a.hasMinimumRole(e.role,t)?n:null}};var u=n(68571);let l=(e,t)=>{switch(t.type){case"AUTH_START":return{...e,isLoading:!0,error:null};case"AUTH_SUCCESS":return{user:t.payload.user,token:t.payload.token,isAuthenticated:!0,isLoading:!1,error:null};case"AUTH_ERROR":return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:t.payload};case"AUTH_LOGOUT":return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null};case"AUTH_INIT":if(t.payload)return{user:t.payload.user,token:t.payload.token,isAuthenticated:!0,isLoading:!1,error:null};return{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null};default:return e}},h=(0,i.createContext)(void 0),d={user:null,token:null,isAuthenticated:!1,isLoading:!0,error:null},m=e=>{let{children:t,apiBaseUrl:n=u.env.NEXT_PUBLIC_API_URL||"http://localhost:3001"}=e,[r,a]=(0,i.useReducer)(l,d),m=(0,i.useCallback)(()=>{let e=s.q.getToken(),t=s.q.getUser();e&&t&&!s.l.isTokenExpired(e)?a({type:"AUTH_INIT",payload:{user:t,token:e}}):(s.q.clearAll(),a({type:"AUTH_INIT",payload:null}))},[]),f=(0,i.useCallback)(async e=>{a({type:"AUTH_START"});try{let t=await fetch("".concat(n,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Login failed")}let o=await t.json();s.q.setToken(o.token),s.q.setUser(o.user),a({type:"AUTH_SUCCESS",payload:{user:o.user,token:o.token}})}catch(e){throw a({type:"AUTH_ERROR",payload:e instanceof Error?e.message:"Login failed"}),e}},[n]),g=(0,i.useCallback)(async()=>{try{let e=s.q.getToken();e&&await fetch("".concat(n,"/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).catch(()=>{})}finally{s.q.clearAll(),a({type:"AUTH_LOGOUT"})}},[n]),p=(0,i.useCallback)(async()=>{let e=s.q.getRefreshToken();if(!e){g();return}try{let t=await fetch("".concat(n,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)throw Error("Token refresh failed");let o=await t.json();s.q.setToken(o.token),s.q.setUser(o.user),a({type:"AUTH_SUCCESS",payload:{user:o.user,token:o.token}})}catch(e){g()}},[n,g]);(0,i.useEffect)(()=>{if(!r.token)return;let e=setInterval(()=>{s.l.isTokenExpired(r.token)&&p()},6e4);return()=>clearInterval(e)},[r.token,p]),(0,i.useEffect)(()=>{m()},[m]);let S=c(r.user),v={...r,login:f,logout:g,refreshToken:p,permissions:S};return(0,o.jsx)(h.Provider,{value:v,children:t})}},94057:function(e,t,n){"use strict";n.d(t,{l:function(){return a},q:function(){return c}});let o="auth_token",i="auth_user",s="refresh_token";class r{isLocalStorageAvailable(){try{let e="test";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}setItem(e,t){if(this.isLocalStorageAvailable())localStorage.setItem(e,t);else try{sessionStorage.setItem(e,t)}catch(e){console.warn("Storage not available")}}getItem(e){if(this.isLocalStorageAvailable())return localStorage.getItem(e);try{return sessionStorage.getItem(e)}catch(e){return null}}removeItem(e){if(this.isLocalStorageAvailable())localStorage.removeItem(e);else try{sessionStorage.removeItem(e)}catch(e){}}getToken(){return this.getItem(o)}setToken(e){this.setItem(o,e)}removeToken(){this.removeItem(o)}getRefreshToken(){return this.getItem(s)}setRefreshToken(e){this.setItem(s,e)}removeRefreshToken(){this.removeItem(s)}getUser(){let e=this.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}setUser(e){this.setItem(i,JSON.stringify(e))}removeUser(){this.removeItem(i)}clearAll(){this.removeToken(),this.removeRefreshToken(),this.removeUser()}}class a{static decodePayload(e){try{let t=e.split(".");if(3!==t.length)return null;let n=t[1],o=atob(n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(o)}catch(e){return null}}static isTokenExpired(e){let t=this.decodePayload(e);if(!t||!t.exp)return!0;let n=Math.floor(Date.now()/1e3);return t.exp<n}static getTokenExpiration(e){let t=this.decodePayload(e);return t&&t.exp?new Date(1e3*t.exp):null}static extractUserFromToken(e){let t=this.decodePayload(e);return t?{id:t.sub,email:t.email,role:t.role,permissions:t.permissions||[]}:null}}let c=new r},79316:function(e,t,n){"use strict";n.d(t,{k:function(){return u}});var o=n(58807),i=n(26422),s=n(94057),r=n(36276),a=n(68571);class c{async connect(){if(this.connectionState.isConnected||this.connectionState.isConnecting){this.log("Already connected or connecting");return}this.connectionState.isConnecting=!0,this.connectionState.error=null;try{this.log("Connecting to WebSocket server:",this.config.url),this.socket=(0,o.io)(this.config.url,{timeout:this.config.timeout,transports:["websocket","polling"],autoConnect:!1}),this.setupEventListeners(),await new Promise((e,t)=>{let n=setTimeout(()=>{t(Error("Connection timeout"))},this.config.timeout);this.socket.once("connect",()=>{clearTimeout(n),e()}),this.socket.once("connect_error",e=>{clearTimeout(n),t(e)}),this.socket.connect()}),this.connectionState.isConnected=!0,this.connectionState.isConnecting=!1,this.connectionState.lastConnectedAt=new Date,this.connectionState.reconnectAttempts=0,this.log("Connected to WebSocket server");let e=s.q.getToken();e&&!s.l.isTokenExpired(e)&&await this.authenticate(e)}catch(e){throw this.connectionState.isConnecting=!1,this.connectionState.error=e instanceof Error?e.message:"Connection failed",this.log("Connection failed:",e),this.config.autoReconnect&&this.scheduleReconnect(),e}}disconnect(){this.log("Disconnecting from WebSocket server"),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.authRetryTimer&&(clearTimeout(this.authRetryTimer),this.authRetryTimer=null),this.socket&&(this.socket.disconnect(),this.socket=null),this.connectionState.isConnected=!1,this.connectionState.isConnecting=!1,this.connectionState.isAuthenticated=!1,this.connectionState.lastDisconnectedAt=new Date,this.connectionState.reconnectAttempts=0,this.roomSubscriptions.clear()}async authenticate(e){if(!this.socket||!this.connectionState.isConnected)throw Error("Not connected to WebSocket server");if(s.l.isTokenExpired(e))throw Error("Token is expired");return this.log("Authenticating with server"),new Promise((t,n)=>{let o=setTimeout(()=>{n(Error("Authentication timeout"))},this.config.timeout);this.socket.once("auth:success",e=>{clearTimeout(o),this.connectionState.isAuthenticated=!0,this.connectionState.error=null,this.log("Authentication successful:",e),t()}),this.socket.once("auth:error",e=>{clearTimeout(o),this.connectionState.isAuthenticated=!1,this.connectionState.error=e.message||"Authentication failed",this.log("Authentication failed:",e),n(Error(e.message||"Authentication failed"))}),this.socket.emit("authenticate",{token:e})})}isConnected(){return this.connectionState.isConnected}isAuthenticated(){return this.connectionState.isAuthenticated}getConnectionState(){return{...this.connectionState}}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t),this.log("Event listener registered for: ".concat(e))}off(e,t){let n=this.eventListeners.get(e);n&&(n.delete(t),0===n.size&&this.eventListeners.delete(e),this.log("Event listener removed for: ".concat(e)))}emit(e,t){let n=this.eventListeners.get(e);n&&n.forEach(n=>{try{n(t)}catch(t){this.log("Error in event listener for ".concat(e,":"),t)}})}async joinRoom(e){if(!this.socket||!this.connectionState.isAuthenticated)throw Error("Not connected or authenticated");return new Promise((t,n)=>{let o=setTimeout(()=>{n(Error("Failed to join room: ".concat(e)))},this.config.timeout);this.socket.once("room:joined",n=>{n.room===e&&(clearTimeout(o),this.roomSubscriptions.has(e)?this.roomSubscriptions.get(e).isSubscribed=!0:this.roomSubscriptions.set(e,{room:e,subscriptions:new Set,isSubscribed:!0}),this.log("Joined room: ".concat(e,", members: ").concat(n.members)),t())}),this.socket.once("room:error",t=>{clearTimeout(o),this.log("Failed to join room ".concat(e,":"),t),n(Error(t.message||"Failed to join room: ".concat(e)))}),this.socket.emit("join:room",{room:e})})}async leaveRoom(e){if(!this.socket)throw Error("Not connected");return new Promise((t,n)=>{let o=setTimeout(()=>{n(Error("Failed to leave room: ".concat(e)))},this.config.timeout);this.socket.once("room:left",n=>{if(n.room===e){clearTimeout(o);let n=this.roomSubscriptions.get(e);n&&(n.isSubscribed=!1),this.log("Left room: ".concat(e)),t()}}),this.socket.emit("leave:room",{room:e})})}subscribeToRoom(e,t,n){this.roomSubscriptions.has(e)||this.roomSubscriptions.set(e,{room:e,subscriptions:new Set,isSubscribed:!1}),this.roomSubscriptions.get(e).subscriptions.add(n),this.on(t,n),this.log("Subscribed to ".concat(t," in room: ").concat(e))}unsubscribeFromRoom(e,t,n){let o=this.roomSubscriptions.get(e);o&&(o.subscriptions.delete(n),this.off(t,n),this.log("Unsubscribed from ".concat(t," in room: ").concat(e)))}getRoomSubscriptions(){let e={};return this.roomSubscriptions.forEach((t,n)=>{e[n]={...t}}),e}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{this.log("Socket connected"),this.connectionState.isConnected=!0,this.connectionState.isConnecting=!1,this.connectionState.lastConnectedAt=new Date,this.connectionState.reconnectAttempts=0}),this.socket.on("disconnect",e=>{this.log("Socket disconnected:",e),this.connectionState.isConnected=!1,this.connectionState.isAuthenticated=!1,this.connectionState.lastDisconnectedAt=new Date,"io server disconnect"===e?this.connectionState.error="Server disconnected":this.config.autoReconnect&&this.scheduleReconnect()}),this.socket.on("connect_error",e=>{this.log("Connection error:",e),this.connectionState.error=e.message,this.config.autoReconnect&&this.scheduleReconnect()}),this.socket.onAny((e,t)=>{try{let n={event:e,timestamp:new Date().toISOString(),...t},o=r.k6.parse(n);this.emit(o.event,o)}catch(t){t instanceof i.jm?this.log("Invalid event format for ".concat(e,":"),t.errors):this.log("Error processing event ".concat(e,":"),t)}}))}scheduleReconnect(){if(this.connectionState.reconnectAttempts>=this.config.maxReconnectAttempts){this.log("Max reconnection attempts reached"),this.connectionState.error="Max reconnection attempts reached";return}let e=Math.min(this.config.reconnectInterval*Math.pow(2,this.connectionState.reconnectAttempts),3e4);this.connectionState.reconnectAttempts++,this.log("Scheduling reconnection attempt ".concat(this.connectionState.reconnectAttempts," in ").concat(e,"ms")),this.reconnectTimer=setTimeout(()=>{this.log("Reconnection attempt ".concat(this.connectionState.reconnectAttempts)),this.connect().catch(e=>{this.log("Reconnection failed:",e)})},e)}log(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.config.enableDebugLogs&&console.log("[WebSocket] ".concat(e),...n)}constructor(e={}){this.socket=null,this.eventListeners=new Map,this.roomSubscriptions=new Map,this.reconnectTimer=null,this.authRetryTimer=null,this.config={url:a.env.NEXT_PUBLIC_WEBSOCKET_URL||"ws://localhost:3001",autoReconnect:!0,reconnectInterval:1e3,maxReconnectAttempts:5,timeout:1e4,enableDebugLogs:!1,...e},this.connectionState={isConnected:!1,isConnecting:!1,isAuthenticated:!1,reconnectAttempts:0,lastConnectedAt:null,lastDisconnectedAt:null,error:null},this.log("WebSocket client initialized with config:",this.config)}}let u=new c},91852:function(e,t,n){"use strict";n.d(t,{WebSocketProvider:function(){return c}});var o=n(70442),i=n(26449),s=n(79316),r=n(8802);let a=(0,i.createContext)(void 0);function c(e){let{children:t,client:n=s.k,autoConnect:c=!0,room:u}=e,l=(0,r.h5)(u,n),h=(0,i.useRef)(!1);(0,i.useEffect)(()=>{!c||h.current||l.isConnected||l.isConnecting||(h.current=!0,l.connect().catch(e=>{console.error("Auto-connect failed:",e)}))},[c,l]);let d={client:n,isConnected:l.isConnected,isAuthenticated:l.isAuthenticated,isConnecting:l.isConnecting,error:l.error,connect:l.connect,disconnect:l.disconnect,authenticate:l.authenticate,isAuthenticating:l.isAuthenticating,authError:l.authError};return(0,o.jsx)(a.Provider,{value:d,children:t})}},8802:function(e,t,n){"use strict";n.d(t,{h5:function(){return r}});var o=n(26449),i=n(79316),s=n(94057);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.k,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.k,[t,n]=(0,o.useState)(e.getConnectionState()),s=(0,o.useCallback)(async()=>{try{await e.connect()}catch(e){console.error("Failed to connect to WebSocket:",e)}},[e]),r=(0,o.useCallback)(()=>{e.disconnect()},[e]);return(0,o.useEffect)(()=>{let t=()=>{n(e.getConnectionState())};return e.on("auth:success",t),e.on("auth:error",t),e.on("user:connected",t),e.on("user:disconnected",t),t(),e.isConnected()||s(),()=>{e.off("auth:success",t),e.off("auth:error",t),e.off("user:connected",t),e.off("user:disconnected",t)}},[e,s]),{connectionState:t,connect:s,disconnect:r,isConnected:t.isConnected,isAuthenticated:t.isAuthenticated,isConnecting:t.isConnecting,error:t.error}}(t),r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.k,[t,n]=(0,o.useState)(!1),[r,a]=(0,o.useState)(null),c=(0,o.useCallback)(async()=>{let t=s.q.getToken();if(!t)return a("No authentication token available"),!1;n(!0),a(null);try{return await e.authenticate(t),!0}catch(e){return a(e instanceof Error?e.message:"Authentication failed"),!1}finally{n(!1)}},[e]);return(0,o.useEffect)(()=>{let t=()=>{c()};return e.on("auth:required",t),()=>{e.off("auth:required",t)}},[e,c]),(0,o.useEffect)(()=>{!e.isConnected()||e.isAuthenticated()||t||c()},[e,c,t]),{authenticate:c,isAuthenticating:t,authError:r}}(t),a=e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.k,[n,s]=(0,o.useState)(!1),[r,a]=(0,o.useState)(!1),[c,u]=(0,o.useState)(null),l=(0,o.useCallback)(async()=>{if(!n&&!r){a(!0),u(null);try{await t.joinRoom(e),s(!0)}catch(e){u(e instanceof Error?e.message:"Failed to join room")}finally{a(!1)}}},[t,e,n,r]),h=(0,o.useCallback)(async()=>{if(n)try{await t.leaveRoom(e),s(!1)}catch(e){u(e instanceof Error?e.message:"Failed to leave room")}},[t,e,n]),d=(0,o.useCallback)((n,o)=>{t.subscribeToRoom(e,n,o)},[t,e]),m=(0,o.useCallback)((n,o)=>{t.unsubscribeFromRoom(e,n,o)},[t,e]);return(0,o.useEffect)(()=>{!t.isAuthenticated()||n||r||l()},[t,l,n,r]),(0,o.useEffect)(()=>()=>{n&&h()},[h,n]),{isSubscribed:n,isJoining:r,error:c,joinRoom:l,leaveRoom:h,subscribeToEvent:d,unsubscribeFromEvent:m}}(e,t):null,c=function(){var e,t,n,s;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.k,[a,c]=(0,o.useState)(null),[u,l]=(0,o.useState)(null);return!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.k,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=(0,o.useRef)(t);r.current=t,(0,o.useEffect)(()=>{let t=e=>{r.current(e)};return n.on(e,t),()=>{n.off(e,t)}},[n,e,...s])}("system:status",(0,o.useCallback)(e=>{c(e.data),l(new Date)},[]),r),{systemStatus:a,lastUpdate:u,activeTasks:null!==(e=null==a?void 0:a.activeTasks)&&void 0!==e?e:0,queueLength:null!==(t=null==a?void 0:a.queueLength)&&void 0!==t?t:0,workerStatus:null!==(n=null==a?void 0:a.workerStatus)&&void 0!==n?n:"unavailable",uptime:null!==(s=null==a?void 0:a.uptime)&&void 0!==s?s:0}}(t);return{...n,...r,room:a?{...a,room:e}:null,systemStatus:c.systemStatus,systemLastUpdate:c.lastUpdate}}},36276:function(e,t,n){"use strict";n.d(t,{k6:function(){return v}});var o=n(63103),i=n(35527);let s=o.Ry({event:o.Z_(),timestamp:o.Z_().datetime(),id:o.Z_().uuid().optional()}),r=s.extend({event:o.i0("task:update"),data:i.TaskStatusSchema}),a=s.extend({event:o.i0("task:created"),data:o.Ry({taskId:o.Z_(),sessionName:o.Z_(),userId:o.Z_(),createdAt:o.Z_().datetime()})}),c=s.extend({event:o.i0("task:completed"),data:o.Ry({taskId:o.Z_(),result:o.Z_().optional(),duration:o.Rx(),exitCode:o.Rx()})}),u=s.extend({event:o.i0("task:error"),data:o.Ry({taskId:o.Z_(),error:o.Z_(),stackTrace:o.Z_().optional()})}),l=s.extend({event:o.i0("system:status"),data:o.Ry({activeTasks:o.Rx(),queueLength:o.Rx(),workerStatus:o.Km(["healthy","degraded","unavailable"]),uptime:o.Rx()})}),h=s.extend({event:o.i0("user:connected"),data:o.Ry({userId:o.Z_(),sessionId:o.Z_(),connectedAt:o.Z_().datetime()})}),d=s.extend({event:o.i0("user:disconnected"),data:o.Ry({userId:o.Z_(),sessionId:o.Z_(),disconnectedAt:o.Z_().datetime(),reason:o.Z_().optional()})}),m=s.extend({event:o.i0("auth:required"),data:o.Ry({message:o.Z_(),retryAfter:o.Rx().optional()})}),f=s.extend({event:o.i0("auth:success"),data:o.Ry({userId:o.Z_(),sessionId:o.Z_(),permissions:o.IX(o.Z_())})}),g=s.extend({event:o.i0("auth:error"),data:o.Ry({message:o.Z_(),code:o.Z_()})}),p=s.extend({event:o.i0("room:joined"),data:o.Ry({room:o.Z_(),members:o.Rx()})}),S=s.extend({event:o.i0("room:left"),data:o.Ry({room:o.Z_(),reason:o.Z_().optional()})}),v=o.VK("event",[r,a,c,u,l,h,d,m,f,g,p,S])},35527:function(e,t,n){"use strict";var o=Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]};Object.defineProperty(t,"__esModule",{value:!0}),t.workerConfig=void 0,function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)}(n(56254),t);var i=n(77364);Object.defineProperty(t,"workerConfig",{enumerable:!0,get:function(){return i.default}})},77364:function(e,t,n){"use strict";var o=n(68571);Object.defineProperty(t,"__esModule",{value:!0});let i=n(12142),s=n(56254);t.default=(0,i.registerAs)("worker",()=>{let e={maxConcurrentTasks:parseInt(o.env.WORKER_MAX_CONCURRENT_TASKS||"5"),processTimeoutMs:parseInt(o.env.WORKER_PROCESS_TIMEOUT_MS||"600000"),gracefulShutdownMs:parseInt(o.env.WORKER_GRACEFUL_SHUTDOWN_MS||"5000"),pidCheckIntervalMs:parseInt(o.env.WORKER_PID_CHECK_INTERVAL_MS||"1000"),fileWatchTimeoutMs:parseInt(o.env.WORKER_FILE_WATCH_TIMEOUT_MS||"30000"),inactivityTimeoutMs:parseInt(o.env.WORKER_INACTIVITY_TIMEOUT_MS||"120000"),pythonExecutable:o.env.PYTHON_EXECUTABLE||"python3",wrapperScriptPath:o.env.PYTHON_WRAPPER_SCRIPT_PATH||"./scripts/claude_wrapper.py",wrapperWorkingDir:o.env.PYTHON_WRAPPER_WORKING_DIR,queueName:o.env.BULLMQ_QUEUE_NAME||"claude-code-tasks",redisHost:o.env.REDIS_HOST||"localhost",redisPort:parseInt(o.env.REDIS_PORT||"6379"),redisPassword:o.env.REDIS_PASSWORD,logLevel:o.env.LOG_LEVEL||"info",enableDetailedLogs:"true"===o.env.ENABLE_DETAILED_LOGS,sessionLogsDir:o.env.SESSION_LOGS_DIR,awaitWriteFinish:"false"!==o.env.AWAIT_WRITE_FINISH,awaitWriteFinishMs:parseInt(o.env.AWAIT_WRITE_FINISH_MS||"100")};return s.WorkerConfigSchema.parse(e)})},56254:function(e,t,n){"use strict";var o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.validateTaskStatus=t.validateWorkerConfig=t.validateClaudeCodeOptions=t.validateTaskExecutionRequest=t.validateProcessConfig=t.TaskStatusSchema=t.WorkerConfigSchema=t.TaskExecutionRequestSchema=t.ClaudeCodeOptionsSchema=t.ProcessConfigSchema=t.TaskState=void 0;let s=n(42396);(i=o||(t.TaskState=o={})).PENDING="pending",i.RUNNING="running",i.ACTIVE="active",i.IDLE="idle",i.COMPLETED="completed",i.FAILED="failed",i.CANCELLED="cancelled",t.ProcessConfigSchema=s.z.object({jobId:s.z.string().min(1,"Job ID is required"),sessionName:s.z.string().min(1,"Session name is required"),workingDirectory:s.z.string().min(1,"Working directory is required"),pythonExecutable:s.z.string().optional().default("python3"),wrapperScriptPath:s.z.string().min(1,"Wrapper script path is required"),unbuffered:s.z.boolean().default(!0)}),t.ClaudeCodeOptionsSchema=s.z.object({model:s.z.string().optional(),maxTokens:s.z.number().positive().optional(),temperature:s.z.number().min(0).max(2).optional(),timeout:s.z.number().positive().optional().default(3e5),permission_mode:s.z.enum(["bypassPermissions","default","plan","acceptEdits"]).optional()}),t.TaskExecutionRequestSchema=s.z.object({id:s.z.string().min(1,"Task ID is required"),prompt:s.z.string().min(1,"Prompt is required"),sessionName:s.z.string().min(1,"Session name is required"),workingDirectory:s.z.string().min(1,"Working directory is required"),options:t.ClaudeCodeOptionsSchema,timeoutMs:s.z.number().positive().optional().default(3e5)}),t.WorkerConfigSchema=s.z.object({maxConcurrentTasks:s.z.number().positive().default(5),processTimeoutMs:s.z.number().positive().default(6e5),gracefulShutdownMs:s.z.number().positive().default(5e3),pidCheckIntervalMs:s.z.number().positive().default(1e3),fileWatchTimeoutMs:s.z.number().positive().default(3e4),inactivityTimeoutMs:s.z.number().positive().default(12e4),pythonExecutable:s.z.string().default("python3"),wrapperScriptPath:s.z.string().min(1,"Wrapper script path is required"),wrapperWorkingDir:s.z.string().optional(),queueName:s.z.string().default("claude-code-tasks"),redisHost:s.z.string().default("localhost"),redisPort:s.z.number().positive().default(6379),redisPassword:s.z.string().optional(),logLevel:s.z.enum(["fatal","error","warn","info","debug","trace"]).default("info"),enableDetailedLogs:s.z.boolean().default(!1),sessionLogsDir:s.z.string().optional(),awaitWriteFinish:s.z.boolean().default(!0),awaitWriteFinishMs:s.z.number().positive().default(100)}),t.TaskStatusSchema=s.z.object({taskId:s.z.string(),state:s.z.nativeEnum(o),pid:s.z.number().optional(),progress:s.z.string().optional(),lastActivity:s.z.date(),error:s.z.string().optional(),exitCode:s.z.number().optional()}),t.validateProcessConfig=e=>t.ProcessConfigSchema.parse(e),t.validateTaskExecutionRequest=e=>t.TaskExecutionRequestSchema.parse(e),t.validateClaudeCodeOptions=e=>t.ClaudeCodeOptionsSchema.parse(e),t.validateWorkerConfig=e=>t.WorkerConfigSchema.parse(e),t.validateTaskStatus=e=>t.TaskStatusSchema.parse(e)}}]);